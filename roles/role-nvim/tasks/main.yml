---
# TODO: replcae this logic with compile from source on the stable branch
#
# git clone git@github.com:neovim/neovim.git
# git checkout stable
# make CMAKE_BUILD_TYPE=RelWithDebInfo
# sudo make installake
#
#  git checkout https://github.com/neovim/neovim
#
# - name: add nvim nightly ppa (popos)
#   when: ansible_distribution == 'Pop!_OS'
#   become: True
#   ansible.builtin.apt_repository:
#     repo: ppa:neovim-ppa/unstable
#     state: present
#
# - name: install nvim nightly and *vim dependencies (popos)
#   when: ansible_distribution == 'Pop!_OS'
#   become: True
#   apt:
#     pkg:
#       - ripgrep
#       - packer
#       - neovim
#       - cargo
#       - pip
#     update_cache: True

# tasks file for roles/role-nvim
- name: install nvim nightly (mac)
  when: ansible_distribution == 'MacOSX'
  community.general.homebrew:
    name:
      - neovim
    state: head

- name: install nvim deps (mac)
  when: ansible_distribution == 'MacOSX'
  community.general.homebrew:
    name:
      - tmux
      - ripgrep
      - stylua
      - fortune
      - fd
    state: present

- name: Install nvm for intellisense server
  shell: >
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash
  args:
    creates: "{{ ansible_env.HOME }}/.nvm/nvm.sh"

- name: install nvim npm dependencies
  community.general.npm:
    name: prettier
    global: yes

- name: Create nvim config directory
  file:
    path: "{{ ansible_env.HOME }}/.config/nvim"
    state: directory

- name: Install my new nvim config
  tags: ["vimrc", "dotfiles"]
  copy:
    src: nvim-0.8/
    dest: "{{ ansible_env.HOME }}/.config/nvim/"
