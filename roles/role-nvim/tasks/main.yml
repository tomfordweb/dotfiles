---
- name: add nvim nightly ppa (popos)
  when: ansible_distribution == 'Pop!_OS'
  become: True
  ansible.builtin.apt_repository:
    repo: ppa:neovim-ppa/unstable
    state: present

- name: install nvim nightly and *vim dependencies (popos)
  when: ansible_distribution == 'Pop!_OS'
  become: True
  apt:
    pkg:
      - ripgrep
      - packer
      - neovim
      - cargo
      - pip
    update_cache: True

# tasks file for roles/role-nvim
- name: install nvim nightly (mac)
  when: ansible_distribution == 'MacOSX'
  community.general.homebrew:
    name:
      - neovim
    state: head

- name: install nvim deps (mac)
  when: ansible_distribution == 'MacOSX'
  community.general.homebrew:
    name:
      - tmux
      - ripgrep
    state: present

- name: Install nvm for intellisense server
  shell: >
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash
  args:
    creates: "{{ ansible_env.HOME }}/.nvm/nvm.sh"

- name: install nvim npm dependencies
  community.general.npm:
    name: prettier
    global: yes

- name: Install vimplug for nvim
  shell: >
    sh -c 'curl -fLo "${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim --create-dirs \
     https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
  args:
    creates: "{{ ansible_env.HOME }}/.local/share/nvim/site/autoload/plug.vim"

# - name: Download lvim installer
#   get_url:
#     dest: /tmp/lvim-installer.sh
#     url: https://raw.githubusercontent.com/lunarvim/lunarvim/master/utils/installer/install.sh

# - name: Execute the lvim-installer.sh
#   script:
#     cmd: /tmp/lvim-installer.sh -y

# - name: Remove the lvim-installer.sh
#   file:
#     path: /tmp/lvim-installer.sh
#     state: absent

- name: Create nvim config directory
  file:
    path: "{{ ansible_env.HOME }}/.config/nvim"
    state: directory

- name: Move lvim config over
  tags: ["vimrc"]
  copy:
    src: lvim/
    dest: "{{ ansible_env.HOME }}/.config/lvim/"

- name: Install my nvim config
  tags: ["vimrc"]
  copy:
    src: nvim/
    dest: "{{ ansible_env.HOME }}/.config/nvim/"

# - name: nvim -> :PlugInstall
#   tags: ["vimrc"]
#   shell: nvim +PlugUpdate +qall --headless
#   changed_when: False

# - name: Lvim -> :Packer*
#   tags: ["vimrc"]
#   shell: lvim +PackerInstall +PackerCompile +qall --headless
#   changed_when: False
